<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
    <title>My first three.js app</title>
    
		<style>
			body {
        background-color: #ffffff;
        margin: 0;
        overflow: hidden;
        }

        #css, #webgl {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0; left: 0;
        }

        #css {
          background: transparent;
        }

        #webgl {
          pointer-events: none;
        }
    </style>
    
  </head>
  
	<body>


		<script type="module">
      import * as THREE from 'https://cdn.skypack.dev/pin/three@v0.129.0-chk6X8RSBl37CcZQlxof/mode=imports/optimized/three.js';
      import { RGBELoader } from 'https://cdn.skypack.dev/three@v0.129.0-chk6X8RSBl37CcZQlxof/examples/jsm/loaders/RGBELoader.js';
      import { GUI } from 'https://cdn.skypack.dev/three@v0.129.0-chk6X8RSBl37CcZQlxof/examples/jsm/libs/dat.gui.module.js';
			import { OrbitControls } from 'https://cdn.skypack.dev/three@v0.129.0-chk6X8RSBl37CcZQlxof/examples/jsm/controls/OrbitControls.js';
      import { CSS3DRenderer, CSS3DObject } from 'https://cdn.skypack.dev/three@v0.129.0-chk6X8RSBl37CcZQlxof/examples/jsm/renderers/CSS3DRenderer.js';


      let camera, scene, renderer, renderer2, light;
			let controls;

      init();
      render();
      animate(performance.now());

      function init(){
        //add camera
        camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 1000 );
        camera.position.z = 20;

        //add scene
        scene = new THREE.Scene();
        console.log(scene);
        scene.background = new THREE.CubeTextureLoader()
          .setPath("img/Skies_1/background/")
          .load( [
            'px.png',
            'nx.png',
            'py.png',
            'ny.png',
            'pz.png',
            'nz.png'
          ] );
        
        //add domElement
        // let page1 = document.createElement('div');
        // page1.style.width = '1000px';
        // page1.style.height ='1000px';
        // page1.style.backgroundColor = '0xbbbbbb';
        // page1.style.opacity = '0.999';
        // // page1.setAttribute('src', '/iframes/1.html');

        // let product1 = new CSS3DObject(page1);
        // product1.position.x = 0;
        // product1.position.y = 0;
        // product1.position.z = 8;
        // scene.add(product1);
        // console.log(product1);

        for ( var i = 0; i < 50; i ++ ) {

          var elementObj = makeElementObject( 'div', 100, 100 );
          elementObj.css3dObject.element.textContent = "I am a <div> element! Edit me!"
          elementObj.css3dObject.element.setAttribute('contenteditable', '')

          elementObj.position.x = Math.random() * 600 - 300;
          elementObj.position.y = Math.random() * 600 - 300;
          elementObj.position.z = Math.random() * 800 - 600;
          elementObj.rotation.x = Math.random();
          elementObj.rotation.y = Math.random();
          elementObj.rotation.z = Math.random();
          scene.add( elementObj );
        }

        //add geometry
        const roundedRectShape = new THREE.Shape();
        ( function roundedRect( ctx, x, y, width, height, radius ) {
          ctx.moveTo( x, y + radius );
          ctx.lineTo( x, y + height - radius );
          ctx.quadraticCurveTo( x, y + height, x + radius, y + height );
          ctx.lineTo( x + width - radius, y + height );
          ctx.quadraticCurveTo( x + width, y + height, x + width, y + height - radius );
          ctx.lineTo( x + width, y + radius );
          ctx.quadraticCurveTo( x + width, y, x + width - radius, y );
          ctx.lineTo( x + radius, y );
          ctx.quadraticCurveTo( x, y, x, y + radius );
        } )( roundedRectShape, 0, 0, 5, 5, 1 );

        const extrudeSettings = {
            steps: 6,
            amount: 0.5,
            bevelEnabled: true,
            bevelThickness: 0.1,
            bevelSize: 0.5,
            bevelSegments: 3
          };

        var material = new THREE.MeshPhysicalMaterial( {
          dithering: true,
          color: 0xFFFFFF,
          metalness: 0,
          roughness: 0.7,
          envMapIntensity: 1,
          depthWrite: false,
          transmission: 1, // use material.transmission for glass materials
          opacity: 1
        } );

        var geometry = new THREE.ExtrudeGeometry( roundedRectShape, extrudeSettings );
        var mesh = new THREE.Mesh( geometry, material );
        mesh.position.x = 0;
        mesh.position.y = 0;
        mesh.position.z = 10;
        mesh.rotation.y = 0;
        scene.add( mesh );
        console.log(mesh);

        //add renderers
        renderer2 = new CSS3DRenderer();
				renderer2.setSize( window.innerWidth, window.innerHeight );
        renderer2.domElement.style.position = 'absolute';
        renderer2.domElement.style.top = 0;
        renderer2.domElement.style.pointerEvent = 'auto';
				document.querySelector('#css').appendChild( renderer2.domElement );

        // renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
        // renderer.setPixelRatio( window.devicePixelRatio );
        // renderer.setSize( window.innerWidth, window.innerHeight );
        // renderer.toneMapping = THREE.ACESFilmicToneMapping;
        // renderer.toneMappingExposure = 1;
        // renderer.outputEncoding = THREE.sRGBEncoding;
        // renderer.shadowMap.enabled = true;
        // document.querySelector('#webgl').appendChild( renderer.domElement );
        renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setClearColor( 0x000000, 0 );
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap; // default THREE.PCFShadowMap
        document.querySelector('#webgl').appendChild( renderer.domElement );

        //add light
        light = new THREE.AmbientLight( 0xffffff ); // soft white light
        scene.add( light );

        //add controls
        controls = new OrbitControls( camera, renderer2.domElement );
        controls.addEventListener( 'change', render ); // use if there is no animation loop
				controls.minDistance = 1;
				controls.maxDistance = 3;
				controls.target.set( 0, 0, 0 );
				controls.update();
      }

			// Our Javascript will go here.

      function makeElementObject(type, width, height) {
          const obj = new THREE.Object3D
          const color = new THREE.Color(
              Math.random() * 0.21568627451 + 0.462745098039,
              Math.random() * 0.21568627451 + 0.462745098039,
              Math.random() * 0.21568627451 + 0.462745098039,
          )

          const element = document.createElement( type );
          element.style.width = width+'px';
          element.style.height = height+'px';
          element.style.opacity = 0.999;
          element.style.background = color.getStyle();


          var css3dObject = new CSS3DObject(element)
          obj.css3dObject = css3dObject;
          obj.add(css3dObject);

          // make an invisible plane for the DOM element to chop
          // clip a WebGL geometry with it.
          var material = new THREE.MeshPhongMaterial({
              opacity	: 0.15,
              color	: new THREE.Color( /*color*/ 0x111111 ),
              blending: THREE.NoBlending,
              side	: THREE.DoubleSide,
          });
          var geometry = new THREE.BoxGeometry( width, height, 1 );
          var mesh = new THREE.Mesh( geometry, material );
          mesh.castShadow = true;
          mesh.receiveShadow = true;
          obj.lightShadowMesh = mesh
          obj.add( mesh );

          return obj
      }

      // const renderTarget = new THREE.WebGLRenderTarget(window.innerWidth, window.innerHeight)

      // const envM = new RGBELoader()
			// 		.setDataType( THREE.UnsignedByteType )
			// 		.setPath("img/Skies_1/")
			// 		.load( 'machine_shop_02_8k.hdr', function ( texture ) {

			// 			const envMap = pmremGenerator.fromEquirectangular( texture ).texture;

			// 			// scene.background = envMap;
			// 			// scene.environment = envMap;

			// 			texture.dispose();
			// 			pmremGenerator.dispose();

      //       console.log(scene.environment);

			// 			render();
			// 		} );


      // const color = 0xFFFFFF;
      // const intensity = 1;
      // const light = new THREE.DirectionalLight(color, intensity);
      // light.position.set(0, 5, -5);
      // scene.add(light);

      

      // const light = new THREE.HemisphereLight( 0xffffff, 0xffffff, 0.5 );
      // scene.add( light );

      

      // const pmremGenerator = new THREE.PMREMGenerator( renderer );
			// pmremGenerator.compileEquirectangularShader();

      

      

      function animate () {
        requestAnimationFrame( animate );

        // mesh.rotation.x += 0.01;
        // mesh.rotation.y += 0.01;

        render();
      };

      function render() {
        // renderer.setRenderTarget(renderTarget);
        renderer.render( scene, camera );
        renderer2.render( scene, camera );
        // renderer.setRenderTarget(null);
      }

      function onDocumentMouseWheel( event ) {
        const fov = camera.fov + event.deltaY * 0.05;
        camera.fov = THREE.MathUtils.clamp( fov, 10, 75 );
        console.log(camera.fov);
        camera.updateProjectionMatrix();
      }

      document.addEventListener( 'wheel', onDocumentMouseWheel );

    </script>
    
    <div id="css"></div>
    <div id="webgl"></div>
  
	</body>
</html>
